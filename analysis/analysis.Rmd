---
title: "Analysis for Project"
output: 
  html_document: 
    fig_height: 6
    fig_width: 9
    toc: yes
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
source(here("analysis","check_packages.R"))
source(here("analysis","useful_functions.R"))
load(here("analysis","output","acs.RData"))
```

# Introduction
<a href="#top">Back to top</a>

Use this R Markdown to perform the main analysis for the project. I use this basically as a lab notebook. It contains the main analysis and a variety of sensitivity analysis. The code in this documents serves as a baseline for the eventual tables and figures that will go into the paper. At the same time it will serve as a record of all supplementary analyses performed. 


```{r}
#try a model
model1 <- glm(below_exp_grade~race+as.factor(year), data=acs, family=binomial)
model2 <- update(model1, .~.+degree_mother+degree_father)
model3 <- update(model2, .~.+sqrt(family_income/10000)+own_home+parents_married)
model4 <- update(model3, .~.+foreign_born_mother+foreign_born_father)

knitreg(list(model1, model2, model3, model4))
```


```{r}
coef_table <- tidy(model4) %>%
  filter(str_detect(term, "race") & str_detect(term, "/") & !str_detect(term, "Multiracial")) %>%
  mutate(term=str_remove(term, "race"))

ggplot(coef_table, aes(x=reorder(term, estimate, mean), y=estimate, 
                       ymin=estimate-1.96*std.error, ymax=estimate+1.96*std.error))+
  geom_hline(yintercept = 0, linetype=2)+
  geom_pointrange()+
  coord_flip()+
  theme_bw()
```